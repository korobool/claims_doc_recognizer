<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Recognition System</title>
    <link rel="stylesheet" href="/static/css/style.css?v=15">
</head>
<body>
    <div class="container">
        <!-- Left panel: upload and image list -->
        <aside class="sidebar left-panel">
            <h2>Images</h2>
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" multiple accept="image/*" hidden>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    üìÅ Upload
                </button>
                <p class="hint">or drag and drop files here</p>
            </div>
            <div class="image-list" id="imageList">
                <!-- List of uploaded images -->
            </div>
        </aside>

        <!-- Center panel: view and process -->
        <main class="main-panel">
            <div class="toolbar">
                <button class="btn" id="normalizeBtn" disabled>
                    üîÑ Normalize
                </button>
                <button class="btn btn-primary" id="recognizeBtn" disabled>
                    üîç Recognize
                </button>
                <button class="btn" id="addBboxBtn" disabled>
                    ‚úèÔ∏è Add BBox
                </button>
            </div>
            <!-- Main area tabs -->
            <div class="main-tabs">
                <button class="main-tab active" data-tab="viewer" id="viewerTabBtn">üìÑ Document Viewer</button>
                <button class="main-tab" data-tab="schemas" id="schemasTabBtn">‚öôÔ∏è Schema Templates</button>
            </div>
            
            <!-- Document Viewer Tab -->
            <div class="main-tab-content active" id="viewerTab">
            <div class="image-viewer" id="imageViewer">
                <div class="placeholder" id="placeholder">
                    <p>Select an image to view</p>
                </div>
                <div class="zoom-wrapper" id="zoomWrapper" style="display: none;">
                    <div class="image-container" id="imageContainer">
                        <img id="mainImage" src="" alt="Document">
                        <div class="text-overlay" id="textOverlay">
                            <!-- Editable text blocks -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="zoom-controls" id="zoomControls" style="display: none;">
                <button class="zoom-btn" id="zoomOutBtn" title="Zoom out (Ctrl+-)">‚àí</button>
                <input type="range" id="zoomSlider" min="25" max="300" value="100" step="5">
                <button class="zoom-btn" id="zoomInBtn" title="Zoom in (Ctrl++)">+</button>
                <span class="zoom-value" id="zoomValue">100%</span>
            </div>
            </div><!-- End viewerTab -->
            
            <!-- Schema Templates Tab -->
            <div class="main-tab-content" id="schemasTab" style="display: none;">
                <div class="schemas-container">
                    <div class="schemas-sidebar">
                        <h3>Document Templates</h3>
                        <div class="schema-list" id="schemaList">
                            <!-- Schema items loaded dynamically -->
                        </div>
                        <button class="btn btn-primary btn-full" id="newSchemaBtn">
                            ‚ûï New Template
                        </button>
                    </div>
                    <div class="schema-editor">
                        <div class="schema-editor-header">
                            <h3 id="schemaEditorTitle">Select a template</h3>
                            <div class="schema-editor-actions">
                                <button class="btn btn-small" id="saveSchemaBtn" disabled>üíæ Save</button>
                                <button class="btn btn-small btn-danger" id="deleteSchemaBtn" disabled>üóëÔ∏è Delete</button>
                            </div>
                        </div>
                        
                        <div class="schema-placeholder" id="schemaPlaceholder">
                            <p>Select a template from the list or create a new one</p>
                        </div>
                        
                        <div class="schema-edit-form" id="schemaEditForm" style="display: none;">
                            <!-- LLM Generation Section -->
                            <div class="schema-llm-section">
                                <label>Generate with AI:</label>
                                <div class="schema-llm-input">
                                    <textarea id="schemaDescription" placeholder="Describe the document type you want to create, e.g., 'A bank statement with account info, transactions list, and balance'"></textarea>
                                    <div class="schema-llm-controls">
                                        <select id="schemaLlmModel">
                                            <option value="">Loading models...</option>
                                        </select>
                                        <button class="btn btn-primary" id="generateSchemaBtn">ü§ñ Generate</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="schema-divider">
                                <span>or edit manually</span>
                            </div>
                            
                            <!-- YAML Editor -->
                            <div class="schema-yaml-section">
                                <label>Schema YAML:</label>
                                <textarea id="schemaYamlEditor" class="yaml-editor" spellcheck="false"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- End schemasTab -->
        </main>

        <!-- Right panel: Results with tabs -->
        <aside class="sidebar right-panel">
            <div class="device-info-container" id="deviceInfoContainer">
                <div class="device-info-header" onclick="toggleDeviceInfo()">
                    <span class="device-info-icon">üñ•Ô∏è</span>
                    <span class="device-info-title">Acceleration</span>
                    <span class="device-info-status" id="deviceInfoStatus">Loading...</span>
                    <span class="device-info-toggle" id="deviceInfoToggle">‚ñº</span>
                </div>
                <div class="device-info-details" id="deviceInfoDetails" style="display: none;">
                    <div class="device-info-row">
                        <span class="device-label">PyTorch:</span>
                        <span class="device-value" id="pytorchVersion">-</span>
                    </div>
                    <div class="device-info-row" id="pytorchCudaRow">
                        <span class="device-label">CUDA Build:</span>
                        <span class="device-value" id="pytorchCudaBuild">-</span>
                    </div>
                    <div class="device-info-separator"></div>
                    <div class="device-info-row acceleration-row">
                        <span class="device-label">Acceleration:</span>
                        <span class="device-value" id="accelerationType">-</span>
                    </div>
                    <div class="device-info-row">
                        <span class="device-label">Device:</span>
                        <span class="device-value" id="selectedDevice">-</span>
                    </div>
                    <div class="device-info-row" id="cudaVersionRow" style="display: none;">
                        <span class="device-label">CUDA Version:</span>
                        <span class="device-value" id="cudaVersion">-</span>
                    </div>
                    <div class="device-info-row" id="gpuCountRow" style="display: none;">
                        <span class="device-label">GPU Count:</span>
                        <span class="device-value" id="gpuCount">-</span>
                    </div>
                    <div class="device-info-row" id="gpuNameRow" style="display: none;">
                        <span class="device-label">GPU:</span>
                        <span class="device-value" id="gpuName">-</span>
                    </div>
                    <div class="device-info-row" id="gpuMemoryRow" style="display: none;">
                        <span class="device-label">GPU Memory:</span>
                        <span class="device-value" id="gpuMemory">-</span>
                    </div>
                    <div class="device-info-separator"></div>
                    <div class="device-info-row">
                        <span class="device-label">Surya OCR:</span>
                        <span class="device-value" id="suryaDevice">Pending</span>
                    </div>
                    <div class="device-info-row">
                        <span class="device-label">CLIP:</span>
                        <span class="device-value" id="clipDevice">Pending</span>
                    </div>
                    <div class="device-info-note" id="deviceInfoNote">Models load on first recognition</div>
                </div>
            </div>
            <div class="document-class-container" id="documentClassContainer" style="display: none;">
                <span class="document-class-label">Document Type:</span>
                <span class="document-class-value" id="documentClassValue">-</span>
                <span class="document-class-confidence" id="documentClassConfidence"></span>
            </div>
            
            <!-- Tab navigation -->
            <div class="result-tabs">
                <button class="tab-btn active" data-tab="json" onclick="switchTab('json')">
                    üìÑ JSON
                </button>
                <button class="tab-btn" data-tab="llm" onclick="switchTab('llm')">
                    ü§ñ LLM Enhanced
                </button>
            </div>
            
            <!-- JSON Tab Content -->
            <div class="tab-content active" id="jsonTab">
                <div class="json-container">
                    <pre id="jsonOutput" contenteditable="false">
{
  "text_lines": [],
  "image_bbox": []
}</pre>
                </div>
            </div>
            
            <!-- LLM Tab Content -->
            <div class="tab-content" id="llmTab" style="display: none;">
                <div class="llm-controls">
                    <div class="llm-status" id="llmStatus">
                        <span class="status-indicator" id="ollamaStatus">‚ö™</span>
                        <span id="ollamaStatusText">Checking Ollama...</span>
                    </div>
                    <div class="llm-acceleration" id="llmAcceleration">
                        <span class="accel-icon" id="accelIcon">‚ö°</span>
                        <span id="accelText">Checking acceleration...</span>
                    </div>
                    <div class="llm-model-select">
                        <label for="llmModelSelect">Model:</label>
                        <select id="llmModelSelect" disabled>
                            <option value="">Loading...</option>
                        </select>
                        <button class="btn btn-small" id="pullModelBtn" disabled title="Pull model if not available">
                            ‚¨áÔ∏è
                        </button>
                    </div>
                    <div class="pull-progress" id="pullProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="pullProgressFill"></div>
                        </div>
                        <span class="progress-text" id="pullProgressText">Downloading...</span>
                    </div>
                    <button class="btn btn-primary" id="processLlmBtn" disabled>
                        üîÑ Process with LLM
                    </button>
                </div>
                <div class="llm-result-container">
                    <div class="llm-placeholder" id="llmPlaceholder">
                        <p>Run OCR first, then click "Process with LLM" to enhance results</p>
                    </div>
                    <div class="llm-result" id="llmResult" style="display: none;">
                        <div class="llm-section" id="llmExtractedFieldsSection">
                            <h4>üìã Extracted Fields <span class="doc-type-badge" id="llmDocTypeBadge"></span></h4>
                            <div class="extracted-fields" id="llmExtractedFields"></div>
                        </div>
                        <div class="llm-section">
                            <h4>üìù Corrected Text</h4>
                            <div class="llm-text" id="llmEnhancedText"></div>
                        </div>
                        <div class="llm-section" id="llmConfidenceSection" style="display: none;">
                            <h4>‚ÑπÔ∏è Notes</h4>
                            <div class="llm-notes" id="llmConfidenceNotes"></div>
                        </div>
                        <div class="llm-meta">
                            <span>Model: <strong id="llmModelUsed">-</strong></span>
                            <span class="llm-doc-type">Document: <strong id="llmDocType">-</strong></span>
                        </div>
                    </div>
                    <div class="llm-loading" id="llmLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Processing with LLM...</p>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-success" id="saveBtn" disabled>
                üíæ Save
            </button>
        </aside>
    </div>

    <script src="/static/js/app.js?v=16"></script>
</body>
</html>
